# This is the configuration for Porter
# You must define steps for each action, but the rest is optional
# See https://porter.sh/author-bundles for documentation on how to configure your bundle
# Uncomment out the sections below to take full advantage of what Porter can do!

name: playing-with-porter
version: 0.1.0
description: "An example Porter configuration"
# TODO: update the registry to your own, e.g. myregistry
registry: getporter

dockerfile: Dockerfile.tmpl

credentials:
- name: do_access_token
  description: "Access Token for Digital Ocean Account"
  env: DO_ACCESS_TOKEN

parameters:
- name: region
  description: "Region to create Database and DO Space"
  type: string
  default: "nyc3"

mixins:
  - exec
  - kubernetes
install:
  - exec:
      description: "Authenticate to doctl"
      command: "doctl"
      arguments:
        - "auth"
        - "init"
        - "-t"
        - "{{bundle.credentials.do_access_token}}"
  - exec:
      description: "Start example cluster"
      command: ./script/up
#      arguments:
#        - "k8s"
#        - "cluster"
#        - "create"
#        - "example"
#  - kubernetes:
#      description: "Deploy cluster" 
#      command: "apply"
#      arguments:
#        - "--context"
#        - "do-nyc1-example"
#        - "-f"
#        - "manifest.yaml"      
#      wait: false

upgrade:
  - exec:
      description: "Authenticate to doctl"
      command: "doctl"
      arguments:
        - "auth"
        - "init"
        - "-t"
        - "{{bundle.credentials.do_access_token}}"

  - kubernetes:
      description: "Upgrade cluster"
      command: "apply"
      arguments:
        - "--context"
        - "do-nyc1-example"
        - "-f"
        - "manifest.yaml"
      wait: false
uninstall:
  - exec:
      description: "Authenticate to doctl"
      command: "doctl"
      arguments:
        - "auth"
        - "init"
        - "-t"
        - "{{bundle.credentials.do_access_token}}"
  -exec: 
      description: "WIP"
      command: "./script/down"
#  - kubernetes:
#      description: "Uninstall the cluster"
#      manifests:
#        - manifest.yaml
#      wait: true

# Below is an example of how to define credentials
# See https://porter.sh/author-bundles/#credentials
#credentials:
#  - name: kubeconfig
#    path: /root/.kube/config
#  - name: username
#    env: USERNAME

# Below is an example of how to define parameters
# See https://porter.sh/author-bundles/#parameters
#parameters:
#  - name: mysql_user
#    type: string
#    default: wordpress
